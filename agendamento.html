// URL da sua API do Google Apps Script (https://script.google.com/macros/s/AKfycbzMV-MCPqt0smrQM_6jKLQr5Kr62JYfSrA1lpuaDNvvrxbgrwBiacL8Kd9SQWF3fr6k/exec)
const API_URL = 'https://script.google.com/macros/s/AKfycbzMV-MCPqt0smrQM_6jKLQr5Kr62JYfSrA1lpuaDNvvrxbgrwBiacL8Kd9SQWF3fr6k/exec';

// Pega a data da URL
const urlParams = new URLSearchParams(window.location.search);
const data = urlParams.get('data');
document.getElementById('info-data').innerHTML = `<h2>Data: ${data}</h2>`;

// Horários disponíveis (simulação - pode substituir por API depois)
const horariosDisponiveis = ["10:00", "11:00", "12:00", "14:00", "15:00", "16:00"];
let horarioSelecionado = null;

// Mostra os horários
const container = document.getElementById("horarios-disponiveis");
horariosDisponiveis.forEach(horario => {
    const botao = document.createElement("div");
    botao.className = "horario";
    botao.textContent = horario;
    botao.onclick = () => {
        horarioSelecionado = horario;
        document.getElementById("formulario").style.display = 'block';
        container.innerHTML = `<p>Horário selecionado: <strong>${horario}</strong></p>`;
    };
    container.appendChild(botao);
});

// Função para enviar o agendamento
async function enviarAgendamento() {
    const nome = document.getElementById('nome').value.trim();
    const telefone = document.getElementById('telefone').value.trim();
    
    if (!nome || !telefone || !horarioSelecionado) {
        alert("Por favor, preencha todos os campos!");
        return;
    }

    try {
        const params = new URLSearchParams();
        params.append('data', data);
        params.append('horario', horarioSelecionado);
        params.append('cliente', nome);
        params.append('telefone', telefone);
        
        const response = await fetch(API_URL, {
            method: 'POST',
            body: params,
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded'
            }
        });
        
        if (response.ok) {
            const resultado = await response.json();
            if (resultado.success) {
                alert(`✅ Agendamento confirmado!\n\n${nome}, seu horário é:\n${data} às ${horarioSelecionado}`);
                document.getElementById('nome').value = '';
                document.getElementById('telefone').value = '';
            } else {
                alert(`❌ Erro: ${resultado.error || "Falha ao agendar"}`);
            }
        } else {
            throw new Error('Falha na rede');
        }
    } catch (error) {
        console.error("Erro:", error);
        alert("⚠️ Erro de conexão. Tente novamente mais tarde.");
    }
}

// Configura o botão de confirmação
document.getElementById("confirmar").addEventListener("click", enviarAgendamento);

// Permite enviar com Enter
document.getElementById("telefone").addEventListener("keypress", (e) => {
    if (e.key === "Enter") {
        enviarAgendamento();
    }
});